import Stripe from "stripe";
import {Menu} from "../../types/modelType";
import {CheckoutSessionRequest} from "../../graphql/resolvers/order";

export function createLineItems(
  checkout: CheckoutSessionRequest,
  menuItems: Menu[]
) {
  const lineItems = checkout.cartItems.map((cartItem) => {
    const menuItem = menuItems.find(
      (item) => item._id.toString() === cartItem.menuItemId.toString()
    );
    if (!menuItem) {
      throw new Error(`Menu item not found: ${cartItem.menuItemId}`);
    }

    const line_item: Stripe.Checkout.SessionCreateParams.LineItem = {
      price_data: {
        currency: "usd",
        unit_amount: menuItem.price * 100,
        product_data: {
          name: menuItem.name,
        },
      },
      quantity: parseInt(cartItem.quantity),
    };
    return line_item;
  });
  return lineItems;
}
